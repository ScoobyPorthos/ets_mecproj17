function rho = density(H)
% evaluation de la densite en slug/ft^3
%
% Copyright 2008: FranÃ§ois Morency
%
% ---------------------------------------------------------------------
% Ces valeurs d'entree de la fonction sont definies par l'usager
% ---------------------------------------------------------------------
% H : altitude en pieds
% ---------------------------------------------------------------------
% Cette valeur est retournee par la fonction
% ---------------------------------------------------------------------
% rho : densite en slug/ft^3

% ---------------------------------------------------------------------
% temperature en Kelvin
% ---------------------------------------------------------------------
T=tempatmstd(H);

% ---------------------------------------------------------------------
% densite de reference en slug/ft^3
% ---------------------------------------------------------------------
rhosl=0.00237;

% ---------------------------------------------------------------------
% Temperature de reference a SL et 11 km, en Kelvin
% ---------------------------------------------------------------------
Tsl=288.16;
T11km=216.66;

% ---------------------------------------------------------------------
% attraction gravitationnelle, en m/s^2
% ---------------------------------------------------------------------
g0=9.8;

% ---------------------------------------------------------------------
% constante d'evolution de temperature, en Kelvin/m
% ---------------------------------------------------------------------
a=-0.0065;

% ---------------------------------------------------------------------
% constante des gaz pour l'air, J / (kg K)
% ---------------------------------------------------------------------
R=287;

if (T > 216.66 ) 
    rho = rhosl*(T/Tsl)^(-g0/(a*R)-1);
else
    % ---------------------------------------------------------------------
    % conversion des pieds en metre
    % ---------------------------------------------------------------------
    hm = H * 0.3048;
    % ---------------------------------------------------------------------
    % densite 11 km
    % ---------------------------------------------------------------------
    rho11km = rhosl*(T11km/Tsl)^(-g0/(a*R)-1);
    % ---------------------------------------------------------------------
    % densite apres 11 km
    % ---------------------------------------------------------------------
    rho=rho11km*exp(-(g0/(R*T))*(hm-11e3));
end
